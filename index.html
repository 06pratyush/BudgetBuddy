<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BudgetBuddy - Student Budget Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .challenge-card { transition: all 0.3s ease; }
        .challenge-card:hover { transform: translateY(-5px); }
        .expense-item { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login/Signup Page -->
    <div id="authPage" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">üí∞ BudgetBuddy</h1>
                <p class="text-gray-600">Smart budgeting for smart students</p>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Welcome Back!</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Email</label>
                        <input type="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="your@email.com">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Password</label>
                        <input type="password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                        Sign In
                    </button>
                </form>
                <p class="text-center text-gray-600 mt-4">
                    Don't have an account? 
                    <button onclick="showSignup()" class="text-purple-600 hover:text-purple-700 font-medium">Sign up</button>
                </p>
            </div>
            
            <!-- Signup Form -->
            <div id="signupForm" class="hidden">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Join BudgetBuddy!</h2>
                <form onsubmit="handleSignup(event)">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Full Name</label>
                        <input type="text" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="John Doe">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Email</label>
                        <input type="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="your@email.com">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">University</label>
                        <input type="text" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Your University">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Password</label>
                        <input type="password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200">
                        Create Account
                    </button>
                </form>
                <p class="text-center text-gray-600 mt-4">
                    Already have an account? 
                    <button onclick="showLogin()" class="text-purple-600 hover:text-purple-700 font-medium">Sign in</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold text-gray-900">üí∞ BudgetBuddy</h1>
                        <span class="ml-4 px-3 py-1 bg-purple-100 text-purple-800 text-sm rounded-full">Student Edition</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <span class="text-2xl">üéØ</span>
                            <span class="text-sm text-gray-600">Streak: <span id="savingsStreak" class="font-semibold text-purple-600">0</span> days</span>
                        </div>
                        <span class="text-gray-700">Welcome, <span id="userName">Student</span>!</span>
                        <button onclick="logout()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition duration-200">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Quick Stats -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100">
                            <span class="text-2xl">üíµ</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Monthly Budget</p>
                            <p class="text-2xl font-semibold text-gray-900">‚Çπ<span id="totalBudget">5000</span></p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-red-100">
                            <span class="text-2xl">üí∏</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Spent</p>
                            <p class="text-2xl font-semibold text-gray-900">‚Çπ<span id="totalSpent">0</span></p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100">
                            <span class="text-2xl">üí∞</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Remaining</p>
                            <p class="text-2xl font-semibold text-gray-900">‚Çπ<span id="remaining">5000</span></p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100">
                            <span class="text-2xl">üèÜ</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Challenges Won</p>
                            <p class="text-2xl font-semibold text-gray-900"><span id="challengesWon">0</span></p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-yellow-100">
                            <span class="text-2xl">‚≠ê</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Reward Points</p>
                            <p class="text-2xl font-semibold text-gray-900"><span id="rewardPoints">0</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- Add Expense -->
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üí≥ Add New Expense</h2>
                        <form onsubmit="addExpense(event)" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Amount (‚Çπ)</label>
                                <input type="number" id="expenseAmount" required min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="100">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                                <select id="expenseCategory" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    <option value="">Select category</option>
                                    <option value="food">üçï Food & Dining</option>
                                    <option value="travel">üöå Travel & Transport</option>
                                    <option value="study">üìö Study Materials</option>
                                    <option value="entertainment">üé¨ Entertainment</option>
                                    <option value="shopping">üõçÔ∏è Shopping</option>
                                    <option value="health">üè• Health & Medical</option>
                                    <option value="other">üì¶ Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <input type="text" id="expenseDescription" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Lunch at cafeteria">
                            </div>
                            <div class="flex items-end">
                                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                                    Add Expense
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Expense Chart -->
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold text-gray-900">üìä Spending Overview</h2>
                            <select id="chartPeriod" onchange="updateChartPeriod()" class="px-3 py-1 border border-gray-300 rounded-lg text-sm">
                                <option value="week">This Week</option>
                                <option value="month" selected>This Month</option>
                                <option value="all">All Time</option>
                            </select>
                        </div>
                        <div class="h-64">
                            <canvas id="expenseChart"></canvas>
                        </div>
                    </div>

                    <!-- Recent Expenses -->
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold text-gray-900">üìù Recent Expenses</h2>
                            <button onclick="exportExpenses()" class="text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-lg transition duration-200">
                                Export CSV
                            </button>
                        </div>
                        <div id="expensesList" class="space-y-3 max-h-96 overflow-y-auto">
                            <p class="text-gray-500 text-center py-8">No expenses yet. Add your first expense above!</p>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-8">
                    <!-- AI Tips -->
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl card-shadow p-6 text-white">
                        <h2 class="text-xl font-semibold mb-4">ü§ñ AI Savings Tip</h2>
                        <p id="aiTip" class="text-blue-100 mb-4">Track your daily expenses to identify spending patterns and save more effectively!</p>
                        <button onclick="generateNewTip()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition duration-200">
                            Get New Tip
                        </button>
                    </div>

                    <!-- Active Challenges -->
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üèÜ Active Challenges</h2>
                        <div id="challengesList" class="space-y-4 mb-4">
                            <!-- Challenges will be populated here -->
                        </div>
                        <button onclick="showAllChallenges()" class="w-full bg-purple-100 hover:bg-purple-200 text-purple-700 font-medium py-2 px-4 rounded-lg transition duration-200">
                            Browse All Challenges
                        </button>
                    </div>

                    <!-- Budget Goal -->
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üéØ Monthly Budget Goal</h2>
                        <div class="mb-4">
                            <div class="flex justify-between text-sm text-gray-600 mb-2">
                                <span>Progress</span>
                                <span id="budgetProgress">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div id="budgetProgressBar" class="bg-purple-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2" id="budgetStatus">You're doing great! Keep it up.</p>
                        </div>
                        <button onclick="setBudgetGoal()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg transition duration-200">
                            Update Budget Goal
                        </button>
                    </div>

                    <!-- Leaderboard -->
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üèÖ Challenge Leaderboard</h2>
                        <div id="leaderboard" class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                                <div class="flex items-center">
                                    <span class="text-2xl mr-3">ü•á</span>
                                    <div>
                                        <p class="font-medium text-gray-900">Sarah K.</p>
                                        <p class="text-sm text-gray-500">15 challenges completed</p>
                                    </div>
                                </div>
                                <span class="text-yellow-600 font-semibold">2,450 pts</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center">
                                    <span class="text-2xl mr-3">ü•à</span>
                                    <div>
                                        <p class="font-medium text-gray-900">Mike R.</p>
                                        <p class="text-sm text-gray-500">12 challenges completed</p>
                                    </div>
                                </div>
                                <span class="text-gray-600 font-semibold">1,980 pts</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                                <div class="flex items-center">
                                    <span class="text-2xl mr-3">ü•â</span>
                                    <div>
                                        <p class="font-medium text-gray-900">Alex T.</p>
                                        <p class="text-sm text-gray-500">10 challenges completed</p>
                                    </div>
                                </div>
                                <span class="text-orange-600 font-semibold">1,650 pts</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg border-2 border-purple-200">
                                <div class="flex items-center">
                                    <span class="text-2xl mr-3">üë§</span>
                                    <div>
                                        <p class="font-medium text-purple-900">You</p>
                                        <p class="text-sm text-purple-600"><span id="userChallengesCount">0</span> challenges completed</p>
                                    </div>
                                </div>
                                <span class="text-purple-600 font-semibold"><span id="userPoints">0</span> pts</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Challenges Modal -->
    <div id="challengesModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl card-shadow p-6 w-full max-w-4xl max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-900">üéØ Available Challenges</h2>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                <button onclick="filterChallenges('all')" class="px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition duration-200" id="filterAll">
                    All Challenges
                </button>
                <button onclick="filterChallenges('savings')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition duration-200" id="filterSavings">
                    Savings
                </button>
                <button onclick="filterChallenges('habit')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition duration-200" id="filterHabit">
                    Habits
                </button>
            </div>
            <div id="allChallengesList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- All challenges will be populated here -->
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl card-shadow p-8 w-full max-w-md text-center">
            <div class="text-6xl mb-4">üéâ</div>
            <h2 class="text-2xl font-semibold text-gray-900 mb-2">Challenge Completed!</h2>
            <p id="successMessage" class="text-gray-600 mb-6">Great job completing your challenge!</p>
            <button onclick="closeSuccessModal()" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-6 rounded-lg transition duration-200">
                Awesome!
            </button>
        </div>
    </div>

    <script>
        // Data Storage
        let expenses = JSON.parse(localStorage.getItem('budgetBuddy_expenses')) || [];
        let userChallenges = JSON.parse(localStorage.getItem('budgetBuddy_challenges')) || [];
        let totalBudget = parseFloat(localStorage.getItem('budgetBuddy_budget')) || 5000;
        let currentUser = localStorage.getItem('budgetBuddy_user') || 'Student';
        let rewardPoints = parseInt(localStorage.getItem('budgetBuddy_points')) || 0;
        let savingsStreak = parseInt(localStorage.getItem('budgetBuddy_streak')) || 0;

        // Available Challenges
        const availableChallenges = [
            { id: 1, title: "Save ‚Çπ100 this week", description: "Reduce spending by ‚Çπ100 compared to last week", reward: 50, duration: 7, type: "savings", difficulty: "easy" },
            { id: 2, title: "No coffee for 3 days", description: "Skip your daily coffee for 3 consecutive days", reward: 30, duration: 3, type: "habit", difficulty: "medium" },
            { id: 3, title: "Cook at home challenge", description: "Prepare all meals at home for 5 days", reward: 100, duration: 5, type: "habit", difficulty: "hard" },
            { id: 4, title: "Transport savings", description: "Use public transport or walk instead of auto/cab", reward: 75, duration: 7, type: "savings", difficulty: "medium" },
            { id: 5, title: "Entertainment budget", description: "Limit entertainment spending to ‚Çπ200 this week", reward: 40, duration: 7, type: "budget", difficulty: "easy" },
            { id: 6, title: "Study material swap", description: "Exchange books with friends instead of buying new", reward: 60, duration: 14, type: "study", difficulty: "medium" },
            { id: 7, title: "Zero food delivery", description: "No food delivery apps for 5 days", reward: 80, duration: 5, type: "habit", difficulty: "hard" },
            { id: 8, title: "Daily expense tracking", description: "Log every expense for 10 days straight", reward: 120, duration: 10, type: "habit", difficulty: "easy" },
            { id: 9, title: "Weekend savings", description: "Spend less than ‚Çπ300 this weekend", reward: 45, duration: 2, type: "savings", difficulty: "medium" },
            { id: 10, title: "Bulk shopping", description: "Buy groceries in bulk to save money", reward: 65, duration: 7, type: "savings", difficulty: "easy" }
        ];

        // AI Tips
        const aiTips = [
            "Try the 50/30/20 rule: 50% needs, 30% wants, 20% savings!",
            "Cook in bulk on weekends to save money and time during weekdays.",
            "Use student discounts whenever possible - they can save you 10-50%!",
            "Track your daily coffee/tea expenses - small amounts add up quickly!",
            "Set up automatic transfers to savings to build the habit.",
            "Compare prices before making any purchase above ‚Çπ500.",
            "Use apps to find the cheapest fuel stations and grocery stores nearby.",
            "Join group purchases with friends to get bulk discounts.",
            "Sell textbooks you no longer need to fund new purchases.",
            "Use the 24-hour rule: wait a day before making non-essential purchases.",
            "Create a shopping list and stick to it to avoid impulse buying.",
            "Use public transport or bike instead of auto/cab for short distances.",
            "Look for free entertainment options like campus events and libraries.",
            "Buy generic brands - they're often 30-40% cheaper than branded items.",
            "Use cashback apps and student credit cards for additional savings."
        ];

        // Authentication Functions
        function showSignup() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        function handleLogin(event) {
            event.preventDefault();
            const email = event.target.querySelector('input[type="email"]').value;
            const name = email.split('@')[0];
            localStorage.setItem('budgetBuddy_user', name);
            currentUser = name;
            showDashboard();
        }

        function handleSignup(event) {
            event.preventDefault();
            const name = event.target.querySelector('input[type="text"]').value;
            localStorage.setItem('budgetBuddy_user', name);
            currentUser = name;
            showDashboard();
        }

        function showDashboard() {
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser;
            initializeDashboard();
        }

        function logout() {
            localStorage.removeItem('budgetBuddy_user');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('authPage').classList.remove('hidden');
            showLogin();
        }

        // Dashboard Functions
        function initializeDashboard() {
            updateStats();
            updateChart();
            displayExpenses();
            displayChallenges();
            generateNewTip();
            updateBudgetProgress();
            updateLeaderboard();
        }

        function addExpense(event) {
            event.preventDefault();
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const category = document.getElementById('expenseCategory').value;
            const description = document.getElementById('expenseDescription').value;

            const expense = {
                id: Date.now(),
                amount: amount,
                category: category,
                description: description,
                date: new Date().toISOString(),
                displayDate: new Date().toLocaleDateString()
            };

            expenses.push(expense);
            localStorage.setItem('budgetBuddy_expenses', JSON.stringify(expenses));

            // Reset form
            event.target.reset();

            // Update dashboard
            updateStats();
            updateChart();
            displayExpenses();
            updateBudgetProgress();

            // Check if this affects any active challenges
            checkChallengeProgress();
        }

        function updateStats() {
            const totalSpent = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            const remaining = Math.max(totalBudget - totalSpent, 0);
            const challengesCompleted = userChallenges.filter(c => c.completed).length;

            document.getElementById('totalBudget').textContent = totalBudget;
            document.getElementById('totalSpent').textContent = totalSpent;
            document.getElementById('remaining').textContent = remaining;
            document.getElementById('challengesWon').textContent = challengesCompleted;
            document.getElementById('rewardPoints').textContent = rewardPoints;
            document.getElementById('savingsStreak').textContent = savingsStreak;
        }

        function updateChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            
            // Calculate category totals
            const categoryTotals = {};
            const categoryIcons = {
                food: 'üçï',
                travel: 'üöå',
                study: 'üìö',
                entertainment: 'üé¨',
                shopping: 'üõçÔ∏è',
                health: 'üè•',
                other: 'üì¶'
            };

            expenses.forEach(expense => {
                categoryTotals[expense.category] = (categoryTotals[expense.category] || 0) + expense.amount;
            });

            const labels = Object.keys(categoryTotals).map(category => 
                `${categoryIcons[category] || 'üì¶'} ${category.charAt(0).toUpperCase() + category.slice(1)}`
            );
            const data = Object.values(categoryTotals);
            const colors = ['#8B5CF6', '#06B6D4', '#10B981', '#F59E0B', '#EF4444', '#6B7280', '#EC4899'];

            if (window.expenseChart) {
                window.expenseChart.destroy();
            }

            window.expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.raw / total) * 100).toFixed(1);
                                    return `${context.label}: ‚Çπ${context.raw} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function displayExpenses() {
            const expensesList = document.getElementById('expensesList');
            
            if (expenses.length === 0) {
                expensesList.innerHTML = '<p class="text-gray-500 text-center py-8">No expenses yet. Add your first expense above!</p>';
                return;
            }

            const recentExpenses = expenses.slice(-10).reverse();
            const icons = {
                food: 'üçï',
                travel: 'üöå',
                study: 'üìö',
                entertainment: 'üé¨',
                shopping: 'üõçÔ∏è',
                health: 'üè•',
                other: 'üì¶'
            };

            expensesList.innerHTML = recentExpenses.map(expense => `
                <div class="expense-item flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition duration-200">
                    <div class="flex items-center">
                        <span class="text-2xl mr-3">${icons[expense.category] || 'üì¶'}</span>
                        <div>
                            <p class="font-medium text-gray-900">${expense.description}</p>
                            <p class="text-sm text-gray-500">${expense.displayDate} ‚Ä¢ ${expense.category}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold text-red-600">-‚Çπ${expense.amount}</span>
                        <button onclick="deleteExpense(${expense.id})" class="ml-2 text-gray-400 hover:text-red-500 transition duration-200">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function deleteExpense(expenseId) {
            if (confirm('Are you sure you want to delete this expense?')) {
                expenses = expenses.filter(expense => expense.id !== expenseId);
                localStorage.setItem('budgetBuddy_expenses', JSON.stringify(expenses));
                updateStats();
                updateChart();
                displayExpenses();
                updateBudgetProgress();
            }
        }

        function displayChallenges() {
            const challengesList = document.getElementById('challengesList');
            
            if (userChallenges.length === 0) {
                // Add some default challenges for new users
                const defaultChallenges = [
                    { ...availableChallenges[0], startDate: new Date(), progress: 0, completed: false },
                    { ...availableChallenges[1], startDate: new Date(), progress: 0, completed: false }
                ];
                userChallenges = defaultChallenges;
                localStorage.setItem('budgetBuddy_challenges', JSON.stringify(userChallenges));
            }

            const activeChallenges = userChallenges.filter(c => !c.completed).slice(0, 3);
            
            if (activeChallenges.length === 0) {
                challengesList.innerHTML = '<p class="text-gray-500 text-center py-4">No active challenges. Browse available challenges below!</p>';
                return;
            }

            challengesList.innerHTML = activeChallenges.map(challenge => {
                const daysLeft = Math.max(0, challenge.duration - Math.floor((new Date() - new Date(challenge.startDate)) / (1000 * 60 * 60 * 24)));
                const progressPercent = Math.min((challenge.progress || 0) * 100, 100);
                
                return `
                    <div class="challenge-card p-4 border border-gray-200 rounded-lg bg-white">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-medium text-gray-900">${challenge.title}</h3>
                            <span class="text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-800">
                                ${daysLeft} days left
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">${challenge.description}</p>
                        <div class="mb-3">
                            <div class="flex justify-between text-xs text-gray-500 mb-1">
                                <span>Progress</span>
                                <span>${progressPercent.toFixed(0)}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: ${progressPercent}%"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-purple-600 font-medium">Reward: ${challenge.reward} pts</span>
                            <button onclick="completeChallenge(${challenge.id})" class="text-sm px-3 py-1 rounded-lg bg-purple-100 text-purple-700 hover:bg-purple-200 transition duration-200">
                                Mark Complete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showAllChallenges() {
            const modal = document.getElementById('challengesModal');
            displayAllChallenges();
            modal.classList.remove('hidden');
        }

        function displayAllChallenges(filter = 'all') {
            const allChallengesList = document.getElementById('allChallengesList');
            
            let filteredChallenges = availableChallenges;
            if (filter !== 'all') {
                filteredChallenges = availableChallenges.filter(challenge => challenge.type === filter);
            }
            
            allChallengesList.innerHTML = filteredChallenges.map(challenge => {
                const isActive = userChallenges.some(uc => uc.id === challenge.id && !uc.completed);
                const isCompleted = userChallenges.some(uc => uc.id === challenge.id && uc.completed);
                
                let buttonClass, buttonText, buttonDisabled;
                if (isCompleted) {
                    buttonClass = 'bg-green-100 text-green-700';
                    buttonText = 'Completed ‚úì';
                    buttonDisabled = 'disabled';
                } else if (isActive) {
                    buttonClass = 'bg-yellow-100 text-yellow-700';
                    buttonText = 'Active';
                    buttonDisabled = 'disabled';
                } else {
                    buttonClass = 'bg-purple-600 text-white hover:bg-purple-700';
                    buttonText = 'Join Challenge';
                    buttonDisabled = '';
                }
                
                return `
                    <div class="challenge-card p-4 border border-gray-200 rounded-lg bg-white">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-medium text-gray-900">${challenge.title}</h3>
                            <span class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600">
                                ${challenge.difficulty}
                            </span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">${challenge.description}</p>
                        <div class="flex items-center justify-between">
                            <div class="text-sm text-gray-500">
                                <span class="text-purple-600 font-medium">${challenge.reward} pts</span> ‚Ä¢ ${challenge.duration} days
                            </div>
                            <button onclick="joinChallenge(${challenge.id})" class="text-sm px-3 py-1 rounded-lg ${buttonClass} transition duration-200" ${buttonDisabled}>
                                ${buttonText}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterChallenges(type) {
            // Update filter button styles
            document.querySelectorAll('[id^="filter"]').forEach(btn => {
                btn.className = 'px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition duration-200';
            });
            document.getElementById(`filter${type.charAt(0).toUpperCase() + type.slice(1)}`).className = 'px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition duration-200';
            
            displayAllChallenges(type);
        }

        function closeModal() {
            document.getElementById('challengesModal').classList.add('hidden');
        }

        function joinChallenge(challengeId) {
            const challenge = availableChallenges.find(c => c.id === challengeId);
            if (challenge && !userChallenges.some(uc => uc.id === challengeId)) {
                userChallenges.push({
                    ...challenge,
                    startDate: new Date(),
                    progress: 0,
                    completed: false
                });
                localStorage.setItem('budgetBuddy_challenges', JSON.stringify(userChallenges));
                displayChallenges();
                displayAllChallenges();
                updateLeaderboard();
            }
        }

        function completeChallenge(challengeId) {
            const challenge = userChallenges.find(c => c.id === challengeId);
            if (challenge && !challenge.completed) {
                challenge.completed = true;
                challenge.completedDate = new Date();
                
                // Award points
                rewardPoints += challenge.reward;
                localStorage.setItem('budgetBuddy_points', rewardPoints);
                
                // Update streak
                savingsStreak += 1;
                localStorage.setItem('budgetBuddy_streak', savingsStreak);
                
                localStorage.setItem('budgetBuddy_challenges', JSON.stringify(userChallenges));
                
                // Show success modal
                showSuccessModal(challenge);
                
                updateStats();
                displayChallenges();
                updateLeaderboard();
            }
        }

        function showSuccessModal(challenge) {
            const modal = document.getElementById('successModal');
            const message = document.getElementById('successMessage');
            message.textContent = `You've completed "${challenge.title}" and earned ${challenge.reward} points!`;
            modal.classList.remove('hidden');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        function generateNewTip() {
            const tipElement = document.getElementById('aiTip');
            tipElement.classList.add('pulse-animation');
            
            setTimeout(() => {
                const randomTip = aiTips[Math.floor(Math.random() * aiTips.length)];
                tipElement.textContent = randomTip;
                tipElement.classList.remove('pulse-animation');
            }, 500);
        }

        function setBudgetGoal() {
            const newBudget = prompt('Enter your monthly budget goal (‚Çπ):', totalBudget);
            if (newBudget && !isNaN(newBudget) && newBudget > 0) {
                totalBudget = parseFloat(newBudget);
                localStorage.setItem('budgetBuddy_budget', totalBudget);
                updateStats();
                updateBudgetProgress();
            }
        }

        function updateBudgetProgress() {
            const totalSpent = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            const progress = Math.min((totalSpent / totalBudget) * 100, 100);
            
            document.getElementById('budgetProgress').textContent = `${progress.toFixed(1)}%`;
            document.getElementById('budgetProgressBar').style.width = `${progress}%`;
            
            // Update status message and color
            const progressBar = document.getElementById('budgetProgressBar');
            const statusElement = document.getElementById('budgetStatus');
            
            if (progress > 90) {
                progressBar.className = 'bg-red-600 h-3 rounded-full transition-all duration-500';
                statusElement.textContent = 'Warning: You\'re close to your budget limit!';
                statusElement.className = 'text-xs text-red-500 mt-2';
            } else if (progress > 75) {
                progressBar.className = 'bg-yellow-600 h-3 rounded-full transition-all duration-500';
                statusElement.textContent = 'Caution: Monitor your spending closely.';
                statusElement.className = 'text-xs text-yellow-600 mt-2';
            } else if (progress > 50) {
                progressBar.className = 'bg-blue-600 h-3 rounded-full transition-all duration-500';
                statusElement.textContent = 'Good progress! Keep tracking your expenses.';
                statusElement.className = 'text-xs text-blue-600 mt-2';
            } else {
                progressBar.className = 'bg-purple-600 h-3 rounded-full transition-all duration-500';
                statusElement.textContent = 'Excellent! You\'re well within your budget.';
                statusElement.className = 'text-xs text-green-600 mt-2';
            }
        }

        function updateLeaderboard() {
            const userChallengesCount = userChallenges.filter(c => c.completed).length;
            document.getElementById('userChallengesCount').textContent = userChallengesCount;
            document.getElementById('userPoints').textContent = rewardPoints;
        }

        function checkChallengeProgress() {
            // This function would check if recent expenses affect challenge progress
            // For demo purposes, we'll just update the display
            displayChallenges();
        }

        function exportExpenses() {
            if (expenses.length === 0) {
                alert('No expenses to export!');
                return;
            }
            
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Date,Category,Description,Amount\n"
                + expenses.map(e => `${e.displayDate},${e.category},${e.description},${e.amount}`).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `expenses_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function updateChartPeriod() {
            // For demo purposes, this just updates the chart with current data
            // In a real app, this would filter expenses by the selected period
            updateChart();
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            if (localStorage.getItem('budgetBuddy_user')) {
                currentUser = localStorage.getItem('budgetBuddy_user');
                showDashboard();
            }

            // Close modals when clicking outside
            document.getElementById('challengesModal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
            
            document.getElementById('successModal').addEventListener('click', function(e) {
                if (e.target === this) closeSuccessModal();
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    closeSuccessModal();
                }
            });
        });

        // Auto-save and periodic updates
        setInterval(() => {
            if (expenses.length > 0) {
                localStorage.setItem('budgetBuddy_expenses', JSON.stringify(expenses));
            }
            if (userChallenges.length > 0) {
                localStorage.setItem('budgetBuddy_challenges', JSON.stringify(userChallenges));
            }
        }, 30000); // Auto-save every 30 seconds
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e718a4649a33e4',t:'MTc1Nzc2MDc1OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
